<!doctype html>
<html lang="es">
  <th:block th:replace="~{fragments/_head :: head('Catálogo — Botica Online')}"></th:block>
<body class="bg-light">
  <th:block th:replace="~{fragments/_navbar :: navbar}"></th:block>

  <div class="container py-4">
    <div class="d-flex flex-wrap align-items-center justify-content-between mb-3 gap-2">
      <div>
        <h2 class="fw-bold mb-0">Catálogo</h2>
        <small class="text-muted" th:if="${items!=null}" th:text="${#lists.size(items)} + ' resultados'">0 resultados</small>
      </div>
      <form class="d-flex align-items-center gap-2" th:action="@{/catalogo}">
        <input class="form-control form-control-sm" name="q" placeholder="Buscar…" th:value="${q}" />
        <select class="form-select form-select-sm" name="orden">
          <option th:value="'recientes'" th:selected="${orden=='recientes'}">Más recientes</option>
          <option th:value="'precio_asc'" th:selected="${orden=='precio_asc'}">Precio: menor a mayor</option>
          <option th:value="'precio_desc'" th:selected="${orden=='precio_desc'}">Precio: mayor a menor</option>
        </select>
        <button class="btn btn-outline-secondary btn-sm"><i class="bi bi-funnel"></i></button>
      </form>
    </div>

    <div class="row g-4">
      <!-- Filtros -->
      <aside class="col-lg-3">
        <div class="accordion" id="filters">
          <div class="accordion-item small-shadow rounded-4 overflow-hidden">
            <h2 class="accordion-header">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#f1" aria-expanded="true">Filtros</button>
            </h2>
            <div id="f1" class="accordion-collapse collapse show">
              <div class="accordion-body">
                <form th:action="@{/catalogo}">
                  <div class="mb-3">
                    <label class="form-label">Categoría</label>
                    <input class="form-control" name="categoria" th:value="${categoria}" />
                  </div>
                  <div class="row g-2 mb-3">
                    <div class="col">
                      <label class="form-label">Mín</label>
                      <input class="form-control" name="min" th:value="${min}" />
                    </div>
                    <div class="col">
                      <label class="form-label">Máx</label>
                      <input class="form-control" name="max" th:value="${max}" />
                    </div>
                  </div>
                  <button class="btn btn-primary w-100">Aplicar</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Grid de productos -->
      <section class="col-lg-9">
        <div class="row g-4" th:if="${items!=null and !items.isEmpty()}">
          <div class="col-md-6 col-lg-4" th:each="p : ${items}">
            <article class="card h-100 product-card small-shadow">
              <div class="ratio ratio-4x3">
                <img class="card-img-top object-fit-cover" th:src="${p.imagenUrl}" th:alt="${p.nombre}" />
              </div>
              <div class="card-body d-flex flex-column">
                <h6 class="card-title mb-1" th:text="${p.nombre}">Nombre</h6>
                <div class="text-muted small mb-2" th:text="${p.categoria}">Categoría</div>
                <div class="fw-bold h5 mb-3">S/. <span th:text="${#numbers.formatDecimal(p.precio,1,2)}"></span></div>
                <form th:action="@{|/carrito/agregar/${p.id}|}" method="post" class="mt-auto">
                  <div class="input-group">
                    <button class="btn btn-outline-secondary js-minus" type="button" aria-label="Disminuir">−</button>
                    <input type="number" class="form-control text-center" min="1" value="1" name="cantidad" />
                    <button class="btn btn-outline-secondary js-plus" type="button" aria-label="Aumentar">+</button>
                  </div>
                  <button class="btn btn-primary w-100 mt-2"><i class="bi bi-bag-plus"></i> Agregar al carrito</button>
                </form>
              </div>
            </article>
          </div>
        </div>

        <!-- Empty state -->
        <div class="text-center p-5 bg-white rounded-4 small-shadow" th:if="${items==null or items.isEmpty()}">
          <i class="bi bi-emoji-frown display-6 d-block mb-2"></i>
          <p class="mb-3">No encontramos resultados. Intenta otro término o ajusta los filtros.</p>
          <a class="btn btn-outline-secondary" th:href="@{/catalogo}">Limpiar filtros</a>
        </div>
      </section>
    </div>
  </div>

  <script>
    document.addEventListener('click', function (e) {
      const minusBtn = e.target.closest('.js-minus');
      const plusBtn  = e.target.closest('.js-plus');
      if (!minusBtn && !plusBtn) return;
      const form = (minusBtn || plusBtn).closest('form');
      if (!form) return;
      const qty = form.querySelector('input[name="cantidad"]');
      if (!qty) return;
      if (minusBtn) qty.stepDown();
      if (plusBtn)  qty.stepUp();
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
