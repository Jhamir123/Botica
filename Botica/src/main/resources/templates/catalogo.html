<!doctype html>
<html lang="es">
  <th:block th:replace="~{fragments/_head :: head('Catálogo — Botica Online')}"></th:block>
<body class="bg-light">
  <th:block th:replace="~{fragments/_navbar :: navbar}"></th:block>

  <div class="container py-4">
    <div class="row g-4">
      <aside class="col-lg-3">
        <div class="bg-white rounded-4 shadow-sm p-3">
          <h5 class="mb-3">Filtros</h5>
          <form th:action="@{/catalogo}">
            <div class="mb-3">
              <label class="form-label">Categoría</label>
              <input class="form-control" name="categoria" th:value="${categoria}">
            </div>
            <div class="row mb-3">
              <div class="col">
                <label class="form-label">Mín</label>
                <input class="form-control" name="min" th:value="${min}">
              </div>
              <div class="col">
                <label class="form-label">Máx</label>
                <input class="form-control" name="max" th:value="${max}">
              </div>
            </div>
            <button class="btn btn-primary w-100">Aplicar</button>
          </form>
        </div>
      </aside>

      <section class="col-lg-9">
        <h2 class="fw-bold mb-3">Catálogo de Medicamentos</h2>
        <p class="text-muted">Explora nuestra selección de productos farmacéuticos.</p>

        <div class="row g-4">
          <div class="col-md-6 col-lg-4" th:each="p : ${items}">
            <div class="card h-100 shadow-sm">
              <img class="card-img-top" th:src="${p.imagenUrl}" th:alt="${p.nombre}">
              <div class="card-body d-flex flex-column">
                <h6 class="card-title" th:text="${p.nombre}">Nombre</h6>
                <div class="fw-bold mb-2">S/. <span th:text="${#numbers.formatDecimal(p.precio,1,2)}"></span></div>
                <form th:action="@{|/carrito/agregar/${p.id}|}" method="post" class="mt-auto">
                  <div class="input-group">
                    <button class="btn btn-outline-secondary js-minus" type="button" aria-label="Disminuir">−</button>
                    <input type="number" class="form-control text-center" min="1" value="1" name="cantidad">
                    <button class="btn btn-outline-secondary js-plus" type="button" aria-label="Aumentar">+</button>
                  </div>
                  <button class="btn btn-primary w-100 mt-2">Agregar al carrito</button>
                </form>
              </div>
            </div>
          </div>
        </div>

      </section>
    </div>
  </div>

  <script>
    // Misma delegación para +/- en catálogo
    document.addEventListener('click', function (e) {
      const minusBtn = e.target.closest('.js-minus');
      const plusBtn  = e.target.closest('.js-plus');
      if (!minusBtn && !plusBtn) return;

      const form = (minusBtn || plusBtn).closest('form');
      if (!form) return;

      const qty = form.querySelector('input[name="cantidad"]');
      if (!qty) return;

      if (minusBtn) qty.stepDown();
      if (plusBtn)  qty.stepUp();
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
