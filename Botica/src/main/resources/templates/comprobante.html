<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <th:block th:replace="~{fragments/_head :: head('Comprobante de compra — Botica Online')}"></th:block>
<body class="bg-light">
  <th:block th:replace="~{fragments/_navbar :: navbar}"></th:block>

  <!-- ===== Estilos específicos de Comprobante ===== -->
  <style>
    :root{
      --prim: var(--autumn-pine-green, #1C3D3A);
      --sec:  var(--dark-green, #2C4F47);
      --mint: var(--pristine-oceanic, #4FB0A6);
      --paper:var(--white-doctor, #F1F9F9);
    }
    .page-hero{
      background: linear-gradient(135deg, var(--mint) 0%, var(--paper) 55%);
      border-radius: 16px;
    }
    .status-steps{ list-style:none; padding:0; margin:0; display:flex; gap:1rem; flex-wrap:wrap }
    .status-steps li{
      display:flex; align-items:center; gap:.5rem; padding:.5rem .75rem;
      border-radius:999px; background:#e7f5f2; color:var(--sec); font-weight:600
    }
    .status-steps .done{ background:#cfe8e3 }
    .status-steps .active{ background:var(--prim); color:#fff }

    .invoice-card{ border-radius:16px }
    .invoice-header{
      border-radius:14px;
      background: #fff;
      border:1px solid #e8efee;
    }
    .stamp-paid{
      color:#fff; background:var(--prim); border-radius:10px; padding:.35rem .6rem; font-weight:700;
    }
    .total-box{ background:var(--prim); color:#fff; border-radius:12px }
    .meta small{ color:#6c757d }
    .actions .btn-light{ border:1px solid #e5eeec }
    .support-card{ border-radius:14px; border:1px dashed var(--mint); background:#fbfefd }
    @media print{
      nav, .actions, .page-hero{ display:none !important }
      .invoice-card{ box-shadow:none }
      body{ background:#fff }
    }
  </style>

  <main class="container py-4">

    <!-- HERO + estado -->
    <div class="page-hero p-3 p-md-4 mb-4 small-shadow">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
        <h2 class="fw-bold m-0">Comprobante de compra</h2>
        <span class="stamp-paid"><i class="bi bi-check2-circle"></i> PAGADO</span>
      </div>
      <ol class="status-steps mt-2">
        <li class="done"><i class="bi bi-bag-check"></i> Pedido</li>
        <li class="done"><i class="bi bi-credit-card"></i> Pago</li>
        <li class="active"><i class="bi bi-receipt"></i> Comprobante</li>
        <li><i class="bi bi-bicycle"></i> En camino</li>
        <li><i class="bi bi-house-door"></i> Entregado</li>
      </ol>
    </div>

    <!-- Recibo -->
    <div class="card invoice-card small-shadow mx-auto" style="max-width: 1024px;">
      <div class="card-body p-3 p-md-4">

        <!-- Cabecera -->
        <div class="invoice-header p-3 p-md-4 mb-4 d-flex flex-wrap gap-3 justify-content-between align-items-start">
          <div class="d-flex gap-3 align-items-center">
            <div class="rounded-3 d-inline-flex align-items-center justify-content-center"
                 style="width:56px;height:56px;background:var(--paper);border:1px solid #e5eeec">
              <i class="bi bi-capsule-pill fs-3" style="color:var(--prim)"></i>
            </div>
            <div>
              <h5 class="fw-bold mb-1">Botica Online</h5>
              <div class="meta small">
                <div>Atención 24/7 | Entrega rápida</div>
              </div>
            </div>
          </div>

          <div class="text-end meta">
            <div><small class="text-muted">Pedido:</small> <span class="fw-semibold" th:text="${venta.numeroBoleta}">BOTI-00000</span></div>
            <div><small class="text-muted">Fecha:</small> <span th:text="${#temporals.format(venta.fecha, 'dd/MM/yyyy HH:mm')}">dd/MM/yyyy HH:mm</span></div>
            <div><small class="text-muted">Método:</small> <span th:text="${venta.metodo}">YAPE</span></div>
            <div><small class="text-muted">Cliente:</small> <span th:text="${venta.emailCliente}">cliente@demo.com</span></div>
          </div>
        </div>

        <!-- Tabla de productos -->
        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr class="text-muted">
                <th style="width:70px;">Producto</th>
                <th>Nombre</th>
                <th class="text-center">Cant.</th>
                <th class="text-end">P. Unitario</th>
                <th class="text-end">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="d : ${detalles}">
                <td>
                  <img th:src="${d.producto.imagenUrl}" src="/img/placeholder.png"
                       class="rounded object-fit-cover" style="width:54px;height:54px" alt="">
                </td>
                <td>
                  <div class="fw-semibold" th:text="${d.producto.nombre}">Producto</div>
                  <div class="small text-muted" th:text="${d.producto.categoria}">Categoría</div>
                </td>
                <td class="text-center" th:text="${d.cantidad}">1</td>
                <td class="text-end" th:text="${'S/. ' + #numbers.formatDecimal(d.precioUnitario,1,'POINT',2,'POINT')}">S/. 0.00</td>
                <td class="text-end" th:text="${'S/. ' + #numbers.formatDecimal(d.subtotal,1,'POINT',2,'POINT')}">S/. 0.00</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Totales -->
        <div class="row justify-content-end">
          <div class="col-md-6 col-lg-5">
            <ul class="list-unstyled mb-3">
              <li class="d-flex justify-content-between">
                <span class="text-muted">Subtotal</span>
                <span>S/. <span th:text="${#numbers.formatDecimal(subtotal,1,'POINT',2,'POINT')}">0.00</span></span>
              </li>
              <li class="d-flex justify-content-between">
                <span class="text-muted">IGV (18%)</span>
                <span>S/. <span th:text="${#numbers.formatDecimal(igv,1,'POINT',2,'POINT')}">0.00</span></span>
              </li>
              <li class="d-flex justify-content-between">
                <span class="text-muted">Envío</span>
                <span th:text="${envio>0 ? 'S/. ' + #numbers.formatDecimal(envio,1,'POINT',2,'POINT') : 'Gratis'}">Gratis</span>
              </li>
            </ul>
            <div class="total-box d-flex justify-content-between align-items-center p-3 fw-bold">
              <span>Total</span>
              <span th:text="${'S/. ' + #numbers.formatDecimal(total,1,'POINT',2,'POINT')}">S/. 0.00</span>
            </div>
          </div>
        </div>

        <!-- Acciones -->
        <div class="actions mt-4 d-flex gap-2 flex-wrap">
          <a class="btn btn-primary" th:href="@{|/comprobante/${venta.id}/pdf|}">
            <i class="bi bi-filetype-pdf"></i> Descargar PDF
          </a>
          <form th:action="@{|/comprobante/${venta.id}/enviar|}" method="post" class="d-flex gap-2">
            <input class="form-control" type="email" name="email" placeholder="tu@correo.com" required>
            <button class="btn btn-outline-secondary" type="submit"><i class="bi bi-send"></i> Enviar</button>
          </form>
          <button type="button" class="btn btn-light" onclick="window.print()"><i class="bi bi-printer"></i> Imprimir</button>
          <a class="btn btn-outline-secondary" th:href="@{/}"><i class="bi bi-house"></i> Volver al inicio</a>
        </div>

        <!-- Soporte / Post-venta -->
        <div class="support-card p-3 p-md-4 mt-4 d-flex flex-wrap align-items-center gap-3">
          <i class="bi bi-life-preserver fs-3" style="color:var(--prim)"></i>
          <div class="flex-grow-1">
            <div class="fw-semibold">¿Necesitas ayuda con tu pedido?</div>
            <div class="small text-muted">Escríbenos si requieres boleta electrónica, cambio o reembolso.</div>
          </div>
          <a class="btn btn-outline-secondary" th:href="@{/contacto}"><i class="bi bi-chat-dots"></i> Contacto</a>
        </div>

      </div>
    </div>

    <!-- CTA final -->
    <div class="text-center mt-4">
      <a class="btn btn-success lift" th:href="@{/catalogo}">
        <i class="bi bi-bag-plus"></i> Seguir comprando
      </a>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
